@use '../shared/sass/colors';

// stylelint-disable-next-line selector-id-pattern
#newspack_modal_checkout_container {
	padding: var( --newspack-ui-spacer-5, 24px );

	form p {
		margin: 0 0 var( --newspack-ui-spacer-5, 24px );

		&:last-child {
			margin-bottom: 0;
		}
	}

	.order-review-wrapper.hidden {
		display: none;
	}

	// Remove support for "Allow customers to log into an existing account during checkout"
	.woocommerce-form-login-toggle {
		display: none;
	}

	// Hide reCAPTCHA badge
	.grecaptcha-badge {
		visibility: hidden !important;
	}

	// Required fields.
	.woocommerce form .form-row .required {
		color: var( --newspack-ui-color-error-50, colors.$color__error );
	}

	// Billing & Shipping fields
	// Make sure there's not a small orphan row
	.woocommerce form {
		.form-row-first:not( :has( + .form-row-last ) ),
		.form-row-last + .form-row-last,
		.form-row-wide + .form-row-last {
			clear: both;
			float: none;
			width: 100%;
		}
	}

	.woocommerce-checkout {
		h3 {
			font-size: var( --newspack-ui-font-size-s, 16px );
			line-height: var( --newspack-ui-line-height-s, 1.5 );
			margin: 0 0 var( --newspack-ui-spacer-5, 24px );
		}

		.woocommerce-billing-fields h3 {
			margin: 0 0 var( --newspack-ui-spacer-5, 24px );
		}

		// After Customer Details
		// stylelint-disable-next-line selector-id-pattern
		#after_customer_details {
			h3 {
				margin-bottom: var( --newspack-ui-spacer-2, 12px );
			}
		}

		// Override label styles from theme
		.woocommerce-billing-fields,
		.woocommerce-account-fields,
		.woocommerce-shipping-fields,
		.woocommerce-additional-fields {
			label {
				font-size: var( --newspack-ui-font-size-s, 16px );
				line-height: var( --newspack-ui-line-height-s, 1.5 );
			}

		}
	}

	// Override billing details spacing.
	// stylelint-disable-next-line selector-id-pattern
	#checkout_details {
		margin-bottom: var( --newspack-ui-spacer-5, 24px );

		h3 {
			margin: 0 0 var( --newspack-ui-spacer-base, 8px );
		}
	}

	.billing-details,
	.shipping-details {
		&:not(:last-child ) {
			margin-bottom: var( --newspack-ui-spacer-5, 24px );
		}

		p {
			margin: 0;
		}
	}

	// Different shipping address toggle
	#ship-to-different-address {
		margin-bottom: 0;

		&,
		label {
			display: block;
		}
	}

	.shipping_address {
		margin-top: var( --newspack-ui-spacer-5, 24px );
	}


	// Gift Subscriptions
	.newspack-wcsg {
		&--gift-toggle {
			align-items: center;
			display: flex;
			font-weight: 700;
			margin-bottom: 0;

			label {
				display: flex !important;
			}

			.woocommerce-input-wrapper {
				line-height: 0.5;
				margin-right: 0.25rem;
			}
		}

		&--gift-email {
			max-height: 0;
			overflow: hidden;
			transition: max-height 0.25s ease-in-out;
			visibility: hidden;

			&.visible {
				max-height: 100px;
				visibility: visible;
			}
		}
	}

	// Name Your Price styles
	.name-your-price {
		margin-bottom: var( --newspack-ui-spacer-5, 24px );
	}

	.modal_checkout_nyp {
		h3 {
			color: var( --newspack-ui-label-color, inherit );
			margin-bottom: var(--newspack-ui-spacer-base, 8px);
		}

		.input-price {
			display: flex;
			align-items: center;
			flex-wrap: nowrap;
			gap: 0.5em;
			margin: 0 0 8px;

			label {
				display: flex;
				align-items: center;
				margin: 0;
				position: relative;
				width: 100%;

				span.currency {
					padding-left: 16px;
					position: absolute;
					left: 0;
				}

				input {
					padding-left: 32px;
				}
			}

			button {
				margin-top: 0;
			}
		}
	}

	// Coupon Styles
	.woocommerce-form-coupon {
		margin-bottom: var( --newspack-ui-spacer-5, 24px );

		h3 {
			color: var( --newspack-ui-label-color, inherit );
			margin-bottom: var( --newspack-ui-spacer-base, 8px );
		}

		p:first-of-type {
			align-items: center;
			display: flex;
			gap: var( --newspack-ui-spacer-base, colors.$newspack-ui-color-neutral-90 );

			input,
			button {
				margin: 0 !important;
			}

			+ .newspack-ui__helper-text {
				margin-top: calc( var( --newspack-ui-spacer-3, 16px ) * -1 );
			}
		}
	}

	// Processing styles
	.modal_checkout_nyp,
	.modal_checkout_coupon {
		&.processing {
			opacity: 0.5;
		}
	}

	// Checkout form heading.
	.woocommerce .order-details-summary {
		// Top margin not needed in newspack ui modal.
		h2 {
			margin-top: 0;
		}
	}

	// Override checkout payment method box.

	.wc_payment_methods {
		margin: 0 0 var( --newspack-ui-spacer-5, 24px );

		label[for="payment_method_stripe"] {
			&.newspack-ui__input-card {
				padding: var( --newspack-ui-spacer-3, 16px ) !important;
			}
		}
	}

	.wc_payment_method {
		+ .wc_payment_method {
			margin-top: var( --newspack-ui-spacer-2, 12px );
		}

		span {
			font-weight: var( --newspack-ui-font-weight-strong, 600 );
		}

		> label:first-of-type {
			margin: unset;
		}

		.payment_box {
			background: transparent;
			font-weight: normal;
			padding: 0;

			p {
				color: var( --newspack-ui-color-neutral-60, colors.$newspack-ui-color-neutral-60 );
				font-size: var( --newspack-ui-font-size-xs, 14px );
				line-height: var( --newspack-ui-line-height-xs, 1.4286 );
			}

			ul.wc-saved-payment-methods {
				padding: 0;

				li {
					margin-bottom: var( --newspack-ui-spacer-3, 16px );

					label {
						font-size: var( --newspack-ui-font-size-xs, 14px );
						font-weight: normal;
						line-height: var( --newspack-ui-line-height-xs, 1.4286 );
					}

					input {
						margin-right: var( --newspack-ui-spacer-base, 8px );
					}
				}
			}

			fieldset {
				margin: 0 0 var( --newspack-ui-spacer-2, 12px );
				padding: 0 !important; // To override inline styles.

				&:last-child {
					margin-bottom: 0;
				}

				p {
					font-size: var(--newspack-ui-font-size-xs, 14px );
					line-height: var( --newspack-ui-line-height-xs, 1.4286 );
					margin-bottom: 0;

					&.form-row {
						display: flex;
						gap: var( --newspack-ui-spacer-2, 12px );
						align-items: flex-start;

						input {
							margin: 0;
						}

						label {
							margin-bottom: 0;
							font-weight: normal;
						}
					}
				}
			}

			.newspack-cover-fees,
			.woocommerce-SavedPaymentMethods-saveNew {
				label {
					font-size: var( --newspack-ui-font-size-xs, 14px );
					line-height: var( --newspack-ui-line-height-xs, 1.4286 );
				}

				&::before {
					display: none;
				}
			}
		}

		// Override a style coming from the theme to hide the radio -- we need this when there's more than one option.
		input.input-radio[name="payment_method"] {
			display: inherit;
		}

		// If the only payment option, we're hiding the radio selection so we don't need a grid.
		&:first-child:last-child .newspack-ui__input-card {
			grid-template-columns: none;
			gap: 0;

			input.input-radio[name="payment_method"] {
				display: none;
			}
		}
	}

	// WooCommerce Payments
	#payment {
		.payment_method_woocommerce_payments .testmode-info {
			margin-bottom: 0;
		}
	}

	// Stripe inputs
	.wc-credit-card-form {
		.form-row-wide {
			margin-bottom: var( --newspack-ui-spacer-base, 8px );
		}
		.wc-stripe-elements-field,
		.wc-stripe-iban-element-field {
			border: 1px solid var( --newspack-ui-color-input-border, colors.$newspack-ui-color-neutral-30 );
			border-radius: var( --newspack-ui-border-radius-m, 6px );
			display: block;
			font-family: var( --newspack-ui-font-family, system-ui );
			font-size: var( --newspack-ui-font-size-s, 16px );
			line-height: var( --newspack-ui-line-height-s, 1.5 );
			padding: calc( var( --newspack-ui-spacer-2, 12px ) - 1px ) calc( var( --newspack-ui-spacer-3, 16px ) - 1px );
		}

		&:has( div.stripe-source-errors[role="alert"]:not( :empty ) ) {
			.wc-stripe-elements-field,
			.wc-stripe-iban-element-field {
				border-color: var( --newspack-ui-color-error-50, colors.$color__error );
			}

			label {
				color: var( --newspack-ui-color-error-50, colors.$color__error );
			}

			.woocommerce_error {
				background: transparent;
				color: var( --newspack-ui-color-error-50, colors.$color__error );
				font-family: var( --newspack-ui-font-family, system-ui );
				font-size: var( --newspack-ui-font-size-xs, 14px );
				line-height: var( --newspack-ui-line-height-xs, 1.4286 );
				padding: 0;
			}
		}
	}

	// Woo Payments inputs
	#wcpay-upe-element,
	.wcpay-upe-element {
		margin: var( --newspack-ui-spacer-3, 16px ) 0;
		padding: 0;
	}

	// Order review table.
	.woocommerce-checkout-review-order-table {
		th,
		td,
		label,
		small {
			font-size: var( --newspack-ui-font-size-xs, 14px ) !important;
			line-height: var( --newspack-ui-line-height-xs, 1.4286 ) !important;
		}

		thead th,
		.recurring-totals th {
			background: transparent;
		}

		// stylelint-disable-next-line selector-id-pattern
		.woocommerce-shipping-totals #shipping_method {
			li,
			label {
				margin: 0;
			}
		}
	}

	.woocommerce .first-payment-date {
		font-family: var( --newspack-ui-font-family, system-ui );
	}

	// Override checkout form terms and condition text.
	.woocommerce-terms-and-conditions-wrapper {
		font-size: var( --newspack-ui-font-size-xs, 14px );
		line-height: var( --newspack-ui-line-height-xs, 1.4286 );
		margin-bottom: 0;
	}

	// Errors
	.woocommerce-invalid {
		input,
		textarea,
		.select2-container--default .select2-selection--single {
			border-color: var( --newspack-ui-color-error-50, colors.$color__error );

			&:focus {
				outline-color: var( --newspack-ui-color-error-50, colors.$color__error );
			}
		}

		label {
			color: var( --newspack-ui-color-error-50, colors.$color__error );
		}
	}

	// Privacy Policy
	.woocommerce-privacy-policy-text {
		color: var( --newspack-ui-color-neutral-60, colors.$newspack-ui-color-neutral-60 );
	}

	// Buttons - adjust spacing
	#place-order {
		margin-bottom: 0;
	}

	// stylelint-disable-next-line selector-id-pattern
	#checkout_back {
		margin-top: 0;
	}

	// Hide woocommerce errors since we are rendering errors inline.
	form.checkout .woocommerce-NoticeGroup {
		display: none;
	}
}
